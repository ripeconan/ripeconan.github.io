
 <!DOCTYPE HTML>
<html >
<head>
  <meta charset="UTF-8">
  
    <title>数据处理之dplyr包 | ripeconan</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="ripeconan">
    

    
    <meta name="description" content="dplyr简介
作者: Hadley Wickham
是plyr包的后续版本

安装包12install.packages(&quot;dplyr&quot;)install.packages(&quot;nycflights13&quot;)
12library(nycflights13)library(dplyr)
dplyr主要功能
filter() (and slice())
arrange()
select() (and re">
<meta property="og:type" content="article">
<meta property="og:title" content="数据处理之dplyr包">
<meta property="og:url" content="http://ripeconan.com/2015/11/23/dplyr/index.html">
<meta property="og:site_name" content="ripeconan">
<meta property="og:description" content="dplyr简介
作者: Hadley Wickham
是plyr包的后续版本

安装包12install.packages(&quot;dplyr&quot;)install.packages(&quot;nycflights13&quot;)
12library(nycflights13)library(dplyr)
dplyr主要功能
filter() (and slice())
arrange()
select() (and re">
<meta property="og:image" content="http://7xo4sl.com1.z0.glb.clouddn.com/2015/R_language/dplyr.png">
<meta property="og:updated_time" content="2015-11-23T13:44:46.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="数据处理之dplyr包">
<meta name="twitter:description" content="dplyr简介
作者: Hadley Wickham
是plyr包的后续版本

安装包12install.packages(&quot;dplyr&quot;)install.packages(&quot;nycflights13&quot;)
12library(nycflights13)library(dplyr)
dplyr主要功能
filter() (and slice())
arrange()
select() (and re">

    
    <link rel="alternative" href="/atom.xml" title="ripeconan" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css" type="text/css">
</head>

  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo.png" alt="ripeconan" title="ripeconan"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="ripeconan">ripeconan</a></h1>
				<h2 class="blog-motto"></h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜單">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">Home</a></li>
					
						<li><a href="/archives">Archives</a></li>
					
					<li>
 					
					<form class="search" action="//google.com/search" method="get" accept-charset="utf-8">
						<label>Search</label>
						<input type="search" id="search" name="q" autocomplete="off" maxlength="20" placeholder="搜索" />
						<input type="hidden" name="q" value="site:ripeconan.com">
					</form>
					
					</li>
				</ul>
			</nav>			
</div>
    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
  
	<article itemprop="articleBody"> 
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2015/11/23/dplyr/" title="数据处理之dplyr包" itemprop="url">数据处理之dplyr包</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="ripeconan" target="_blank" itemprop="author">ripeconan</a>
		
  <p class="article-time">
    <time datetime="2015-11-22T16:00:00.000Z" itemprop="datePublished"> 發表於 2015-11-23</time>
    
  </p>
</header>
	<div class="article-content">
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目錄</strong>
		
			<ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#dplyr_u7B80_u4ECB"><span class="toc-number">1.</span> <span class="toc-text">dplyr简介</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#u5B89_u88C5_u5305"><span class="toc-number">1.1.</span> <span class="toc-text">安装包</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#dplyr_u4E3B_u8981_u529F_u80FD"><span class="toc-number">1.2.</span> <span class="toc-text">dplyr主要功能</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#u6570_u636E_u96C6_u4E86_u89E3"><span class="toc-number">1.3.</span> <span class="toc-text">数据集了解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#u67E5_u770B_u6570_u636E_u96C6"><span class="toc-number">1.4.</span> <span class="toc-text">查看数据集</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Filter_rows_with_filter_28_29"><span class="toc-number">2.</span> <span class="toc-text">Filter rows with filter()</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Use_filter_to_select_all_flights_on_March_13st"><span class="toc-number">2.1.</span> <span class="toc-text">Use filter to select all flights on March 13st</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#filter__u548C_u666E_u901A_u7B5B_u9009_u7684_u533A_u522B"><span class="toc-number">2.2.</span> <span class="toc-text">filter 和普通筛选的区别</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#u4F7F_u7528_u7EC4_u5408_u6761_u4EF6_u7B5B_u9009_u884C"><span class="toc-number">2.3.</span> <span class="toc-text">使用组合条件筛选行</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#u7EC3_u4E60"><span class="toc-number">2.4.</span> <span class="toc-text">练习</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#u4F7F_u7528_u884C_u53F7_u7B5B_u9009_u884C"><span class="toc-number">2.5.</span> <span class="toc-text">使用行号筛选行</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Arrange_rows_with_arrange_28_29"><span class="toc-number">3.</span> <span class="toc-text">Arrange rows with arrange()</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#u6309_u7167_u5E74_u6708_u65E5_u4F9D_u6B21_u6392_u5E8F"><span class="toc-number">3.1.</span> <span class="toc-text">按照年月日依次排序</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#arrange_u7684_u7B49_u4EF7_u547D_u4EE4"><span class="toc-number">3.2.</span> <span class="toc-text">arrange的等价命令</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Select_columns_with_select_28_29"><span class="toc-number">4.</span> <span class="toc-text">Select columns with select()</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#u9009_u62E9_u5E74_u6708_u65E5_u4E09_u5217"><span class="toc-number">4.1.</span> <span class="toc-text">选择年月日三列</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#u9009_u62E9_u76F8_u90BB_u5217"><span class="toc-number">4.2.</span> <span class="toc-text">选择相邻列</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#u5220_u9664_u67D0_u4E9B_u5217"><span class="toc-number">4.3.</span> <span class="toc-text">删除某些列</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#select_u7684_u5468_u8FB9_u51FD_u6570"><span class="toc-number">4.4.</span> <span class="toc-text">select的周边函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#u7EC3_u4E60-1"><span class="toc-number">4.5.</span> <span class="toc-text">练习</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#u4F7F_u7528select_u66F4_u6539_u5217_u540D"><span class="toc-number">4.6.</span> <span class="toc-text">使用select更改列名</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#u4F7F_u7528rename_u66F4_u6539_u5217_u540D"><span class="toc-number">4.7.</span> <span class="toc-text">使用rename更改列名</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Extract_distinct__28unique_29_rows"><span class="toc-number">5.</span> <span class="toc-text">Extract distinct (unique) rows</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#distinct_u591A_u5217"><span class="toc-number">5.1.</span> <span class="toc-text">distinct多列</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Add_new_columns_with_mutate_28_29"><span class="toc-number">6.</span> <span class="toc-text">Add new columns with mutate()</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#mutate_u548Ctransform"><span class="toc-number">6.1.</span> <span class="toc-text">mutate和transform</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#u5982_u679C_u4F7F_u7528transform"><span class="toc-number">6.2.</span> <span class="toc-text">如果使用transform</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Summarise_values_with_summarise_28_29"><span class="toc-number">7.</span> <span class="toc-text">Summarise values with summarise()</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#u968F_u673A_u9009_u62E9_u884C"><span class="toc-number">8.</span> <span class="toc-text">随机选择行</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#sample_n_28_29"><span class="toc-number">8.1.</span> <span class="toc-text">sample_n()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sample_frac_28_29"><span class="toc-number">8.2.</span> <span class="toc-text">sample_frac()</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#dplyr_u8FDB_u9636"><span class="toc-number">9.</span> <span class="toc-text">dplyr进阶</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#u4EE5_u4E0A_u547D_u4EE4_u7684_u5171_u540C_u70B9"><span class="toc-number">9.1.</span> <span class="toc-text">以上命令的共同点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#u8054_u5408_u4F7F_u7528"><span class="toc-number">9.2.</span> <span class="toc-text">联合使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Grouped_operations"><span class="toc-number">9.3.</span> <span class="toc-text">Grouped operations</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#u4F7F_u7528_u5206_u7EC4_u8FDB_u884C_u53D8_u91CF_u7EDF_u8BA1"><span class="toc-number">10.</span> <span class="toc-text">使用分组进行变量统计</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#u4F7F_u7528_group_by__u8FDB_u884C_u7EDF_u8BA1"><span class="toc-number">10.1.</span> <span class="toc-text">使用 group_by 进行统计</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#u4F7F_u7528_ggplot2__u53EF_u89C6_u5316"><span class="toc-number">10.2.</span> <span class="toc-text">使用 ggplot2 可视化</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#summarise_u548C_u5176_u4ED6_u51FD_u6570_u7ED3_u5408_u4F7F_u7528"><span class="toc-number">11.</span> <span class="toc-text">summarise和其他函数结合使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#u8BA1_u7B97_u6BCF_u4E2A_u76EE_u7684_u5730_u63A5_u5F85_u7684_u98DE_u673A_u6570_u91CF_u548C_u964D_u843D_u6B21_u6570"><span class="toc-number">11.1.</span> <span class="toc-text">计算每个目的地接待的飞机数量和降落次数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#u8BA1_u7B97_u6BCF_u4E2A_u76EE_u7684_u5730_u63A5_u5F85_u7684_u98DE_u673A_u6570_u91CF_u548C_u964D_u843D_u6B21_u6570-1"><span class="toc-number">11.2.</span> <span class="toc-text">计算每个目的地接待的飞机数量和降落次数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#u4F7F_u7528_group_by__u8FDB_u884C_u591A_u5C42_u7EA7_u5206_u7EC4"><span class="toc-number">11.3.</span> <span class="toc-text">使用 group_by 进行多层级分组</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#u6309_u6708_u7EDF_u8BA1_u822A_u73ED_u6570_u91CF"><span class="toc-number">11.4.</span> <span class="toc-text">按月统计航班数量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#u6309_u5E74_u7EDF_u8BA1_u822A_u73ED_u6570_u91CF"><span class="toc-number">11.5.</span> <span class="toc-text">按年统计航班数量</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#u7BA1_u9053_u64CD_u4F5C"><span class="toc-number">12.</span> <span class="toc-text">管道操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#dplyr__u57FA_u672C_u8BED_u6CD5_u7684_u5F0A_u75C5"><span class="toc-number">12.1.</span> <span class="toc-text">dplyr 基本语法的弊病</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#u5D4C_u5957_u5F0F_u5199_u6CD5"><span class="toc-number">12.2.</span> <span class="toc-text">嵌套式写法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#u7BA1_u9053_u64CD_u4F5C_3A_Pipe_operator"><span class="toc-number">12.3.</span> <span class="toc-text">管道操作: Pipe operator</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#u7EC3_u4E60-2"><span class="toc-number">12.4.</span> <span class="toc-text">练习</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#u7EC3_u4E60_u9898_u7B54_u6848"><span class="toc-number">13.</span> <span class="toc-text">练习题答案</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2013_u5E743_u6708_u4E2D_u65EC_2C__u5EF6_u8FDF_u8D77_u98DE_u7684_u73ED_u6B21_u6709_u591A_u5C11_3F"><span class="toc-number">13.1.</span> <span class="toc-text">2013年3月中旬, 延迟起飞的班次有多少?</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#u5168_u5E74_u54EA_u4E2A_u6708_u4EFD_u7684_u73ED_u6B21_u5EF6_u8FDF_u5230_u8FBE_u7684_u6BD4_u4F8B_u6700_u9AD8_3F"><span class="toc-number">13.2.</span> <span class="toc-text">全年哪个月份的班次延迟到达的比例最高?</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#u5217_u540D_u9009_u62E9_u95EE_u9898_u7B54_u6848"><span class="toc-number">13.3.</span> <span class="toc-text">列名选择问题答案</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#u6C42_u5E73_u5747_u98DE_u884C_u65F6_u95F4_u6700_u957F_u7684_u4E09_u6761_u822A_u7EBF"><span class="toc-number">13.4.</span> <span class="toc-text">求平均飞行时间最长的三条航线</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#u98DE_u884C_u8DDD_u79BB1000_u4EE5_u4E0A_u53CA_u4EE5_u4E0B_u7684_u822A_u73ED_u5E73_u5747_u5EF6_u8FDF_u5230_u8FBE_u65F6_u95F4"><span class="toc-number">13.5.</span> <span class="toc-text">飞行距离1000以上及以下的航班平均延迟到达时间</span></a></li></ol></li></ol>
		
		</div>
		
		<h2 id="dplyr_u7B80_u4ECB"><a href="#dplyr_u7B80_u4ECB" class="headerlink" title="dplyr简介"></a>dplyr简介</h2><ul>
<li>作者: Hadley Wickham</li>
<li>是plyr包的后续版本</li>
</ul>
<h3 id="u5B89_u88C5_u5305"><a href="#u5B89_u88C5_u5305" class="headerlink" title="安装包"></a>安装包</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">install.packages(<span class="string">"dplyr"</span>)</span><br><span class="line">install.packages(<span class="string">"nycflights13"</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">library</span>(nycflights13)</span><br><span class="line"><span class="keyword">library</span>(dplyr)</span><br></pre></td></tr></table></figure>
<h3 id="dplyr_u4E3B_u8981_u529F_u80FD"><a href="#dplyr_u4E3B_u8981_u529F_u80FD" class="headerlink" title="dplyr主要功能"></a>dplyr主要功能</h3><ul>
<li>filter() (and slice())</li>
<li>arrange()</li>
<li>select() (and rename())</li>
<li>distinct()</li>
<li>mutate() (and transmute())</li>
<li>summarise()</li>
<li>sample_n() and sample_frac()</li>
</ul>
<h3 id="u6570_u636E_u96C6_u4E86_u89E3"><a href="#u6570_u636E_u96C6_u4E86_u89E3" class="headerlink" title="数据集了解"></a>数据集了解</h3><p>使用 <code>nycflights13</code> 包中的 <code>flights</code> 数据集. <code>?flights</code> 查看数据集情况和变量意义</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dim(flights)</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">## [<span class="number">1</span>] <span class="number">336776</span>     <span class="number">16</span></span></span><br></pre></td></tr></table></figure>
<h3 id="u67E5_u770B_u6570_u636E_u96C6"><a href="#u67E5_u770B_u6570_u636E_u96C6" class="headerlink" title="查看数据集"></a>查看数据集</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">head(flights)</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">## Source: local data frame [<span class="number">6</span> x <span class="number">16</span>]</span></span><br><span class="line"><span class="preprocessor">## </span></span><br><span class="line"><span class="preprocessor">##    year month   day dep_time dep_delay arr_time arr_delay carrier tailnum</span></span><br><span class="line"><span class="preprocessor">##   (int) (int) (int)    (int)     (dbl)    (int)     (dbl)   (chr)   (chr)</span></span><br><span class="line"><span class="preprocessor">## <span class="number">1</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span>      <span class="number">517</span>         <span class="number">2</span>      <span class="number">830</span>        <span class="number">11</span>      UA  N14228</span></span><br><span class="line"><span class="preprocessor">## <span class="number">2</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span>      <span class="number">533</span>         <span class="number">4</span>      <span class="number">850</span>        <span class="number">20</span>      UA  N24211</span></span><br><span class="line"><span class="preprocessor">## <span class="number">3</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span>      <span class="number">542</span>         <span class="number">2</span>      <span class="number">923</span>        <span class="number">33</span>      AA  N619AA</span></span><br><span class="line"><span class="preprocessor">## <span class="number">4</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span>      <span class="number">544</span>        -<span class="number">1</span>     <span class="number">1004</span>       -<span class="number">18</span>      B6  N804JB</span></span><br><span class="line"><span class="preprocessor">## <span class="number">5</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span>      <span class="number">554</span>        -<span class="number">6</span>      <span class="number">812</span>       -<span class="number">25</span>      DL  N668DN</span></span><br><span class="line"><span class="preprocessor">## <span class="number">6</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span>      <span class="number">554</span>        -<span class="number">4</span>      <span class="number">740</span>        <span class="number">12</span>      UA  N39463</span></span><br><span class="line"><span class="preprocessor">## Variables not shown: flight (int), origin (chr), dest (chr), air_time</span></span><br><span class="line"><span class="preprocessor">##   (dbl), distance (dbl), hour (dbl), minute (dbl)</span></span><br></pre></td></tr></table></figure>
<h2 id="Filter_rows_with_filter_28_29"><a href="#Filter_rows_with_filter_28_29" class="headerlink" title="Filter rows with filter()"></a>Filter rows with filter()</h2><p>filter() 用来筛选数据框中的行.</p>
<ul>
<li>第一个参数是数据框的名称</li>
<li>后面的参数是筛选条件</li>
</ul>
<p>问题: 如何筛选所有在3月13号出发的飞机?</p>
<h3 id="Use_filter_to_select_all_flights_on_March_13st"><a href="#Use_filter_to_select_all_flights_on_March_13st" class="headerlink" title="Use filter to select all flights on March 13st"></a>Use filter to select all flights on March 13st</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">filter(flights, month == <span class="number">3</span>, day == <span class="number">13</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">## Source: local data frame [<span class="number">974</span> x <span class="number">16</span>]</span></span><br><span class="line"><span class="preprocessor">## </span></span><br><span class="line"><span class="preprocessor">##     year month   day dep_time dep_delay arr_time arr_delay carrier tailnum</span></span><br><span class="line"><span class="preprocessor">##    (int) (int) (int)    (int)     (dbl)    (int)     (dbl)   (chr)   (chr)</span></span><br><span class="line"><span class="preprocessor">## <span class="number">1</span>   <span class="number">2013</span>     <span class="number">3</span>    <span class="number">13</span>      <span class="number">103</span>        <span class="number">68</span>      <span class="number">457</span>        <span class="number">77</span>      B6  N640JB</span></span><br><span class="line"><span class="preprocessor">## <span class="number">2</span>   <span class="number">2013</span>     <span class="number">3</span>    <span class="number">13</span>      <span class="number">458</span>        -<span class="number">2</span>      <span class="number">648</span>         <span class="number">0</span>      US  N107US</span></span><br><span class="line"><span class="preprocessor">## <span class="number">3</span>   <span class="number">2013</span>     <span class="number">3</span>    <span class="number">13</span>      <span class="number">515</span>         <span class="number">0</span>      <span class="number">805</span>        -<span class="number">5</span>      UA  N76153</span></span><br><span class="line"><span class="preprocessor">## <span class="number">4</span>   <span class="number">2013</span>     <span class="number">3</span>    <span class="number">13</span>      <span class="number">525</span>        -<span class="number">5</span>      <span class="number">821</span>        -<span class="number">6</span>      UA  N17233</span></span><br><span class="line"><span class="preprocessor">## <span class="number">5</span>   <span class="number">2013</span>     <span class="number">3</span>    <span class="number">13</span>      <span class="number">541</span>        -<span class="number">4</span>      <span class="number">920</span>        -<span class="number">3</span>      B6  N729JB</span></span><br><span class="line"><span class="preprocessor">## <span class="number">6</span>   <span class="number">2013</span>     <span class="number">3</span>    <span class="number">13</span>      <span class="number">545</span>         <span class="number">5</span>      <span class="number">850</span>         <span class="number">0</span>      AA  N5EFAA</span></span><br><span class="line"><span class="preprocessor">## <span class="number">7</span>   <span class="number">2013</span>     <span class="number">3</span>    <span class="number">13</span>      <span class="number">550</span>       -<span class="number">10</span>      <span class="number">648</span>       -<span class="number">45</span>      UA  N477UA</span></span><br><span class="line"><span class="preprocessor">## <span class="number">8</span>   <span class="number">2013</span>     <span class="number">3</span>    <span class="number">13</span>      <span class="number">553</span>        -<span class="number">7</span>      <span class="number">709</span>       -<span class="number">36</span>      AA  N3HKAA</span></span><br><span class="line"><span class="preprocessor">## <span class="number">9</span>   <span class="number">2013</span>     <span class="number">3</span>    <span class="number">13</span>      <span class="number">553</span>        -<span class="number">7</span>      <span class="number">845</span>       -<span class="number">25</span>      AA  N3JEAA</span></span><br><span class="line"><span class="preprocessor">## <span class="number">10</span>  <span class="number">2013</span>     <span class="number">3</span>    <span class="number">13</span>      <span class="number">553</span>        -<span class="number">7</span>      <span class="number">714</span>        -<span class="number">9</span>      B6  N239JB</span></span><br><span class="line"><span class="preprocessor">## ..   ...   ...   ...      ...       ...      ...       ...     ...     ...</span></span><br><span class="line"><span class="preprocessor">## Variables not shown: flight (int), origin (chr), dest (chr), air_time</span></span><br><span class="line"><span class="preprocessor">##   (dbl), distance (dbl), hour (dbl), minute (dbl)</span></span><br></pre></td></tr></table></figure>
<h3 id="filter__u548C_u666E_u901A_u7B5B_u9009_u7684_u533A_u522B"><a href="#filter__u548C_u666E_u901A_u7B5B_u9009_u7684_u533A_u522B" class="headerlink" title="filter 和普通筛选的区别"></a>filter 和普通筛选的区别</h3><p>以下几个筛选等价</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">filter(flights, month == <span class="number">3</span>, day == <span class="number">13</span>)</span><br><span class="line">flights[flights$month == <span class="number">3</span> &amp; flights$day == <span class="number">13</span>, ]</span><br><span class="line">subset(flights, month == <span class="number">3</span> &amp; day == <span class="number">13</span>)</span><br></pre></td></tr></table></figure>
<h3 id="u4F7F_u7528_u7EC4_u5408_u6761_u4EF6_u7B5B_u9009_u884C"><a href="#u4F7F_u7528_u7EC4_u5408_u6761_u4EF6_u7B5B_u9009_u884C" class="headerlink" title="使用组合条件筛选行"></a>使用组合条件筛选行</h3><ul>
<li>filter() 与 subset() 类似</li>
<li>对于并列条件, filter可以使用逗号分隔, subset需要使用 &amp; 符号</li>
<li>也可以使用”或”</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">filter(flights, month == <span class="number">1</span> | month == <span class="number">2</span>)</span><br></pre></td></tr></table></figure>
<h3 id="u7EC3_u4E60"><a href="#u7EC3_u4E60" class="headerlink" title="练习"></a>练习</h3><ol>
<li>2013年3月中旬, 延迟起飞的班次有多少? </li>
<li>全年哪个月份的班次延迟到达的比例最高?(table函数)</li>
</ol>
<h3 id="u4F7F_u7528_u884C_u53F7_u7B5B_u9009_u884C"><a href="#u4F7F_u7528_u884C_u53F7_u7B5B_u9009_u884C" class="headerlink" title="使用行号筛选行"></a>使用行号筛选行</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">slice(flights, <span class="number">1</span>:<span class="number">5</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">## Source: local data frame [<span class="number">5</span> x <span class="number">16</span>]</span></span><br><span class="line"><span class="preprocessor">## </span></span><br><span class="line"><span class="preprocessor">##    year month   day dep_time dep_delay arr_time arr_delay carrier tailnum</span></span><br><span class="line"><span class="preprocessor">##   (int) (int) (int)    (int)     (dbl)    (int)     (dbl)   (chr)   (chr)</span></span><br><span class="line"><span class="preprocessor">## <span class="number">1</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span>      <span class="number">517</span>         <span class="number">2</span>      <span class="number">830</span>        <span class="number">11</span>      UA  N14228</span></span><br><span class="line"><span class="preprocessor">## <span class="number">2</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span>      <span class="number">533</span>         <span class="number">4</span>      <span class="number">850</span>        <span class="number">20</span>      UA  N24211</span></span><br><span class="line"><span class="preprocessor">## <span class="number">3</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span>      <span class="number">542</span>         <span class="number">2</span>      <span class="number">923</span>        <span class="number">33</span>      AA  N619AA</span></span><br><span class="line"><span class="preprocessor">## <span class="number">4</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span>      <span class="number">544</span>        -<span class="number">1</span>     <span class="number">1004</span>       -<span class="number">18</span>      B6  N804JB</span></span><br><span class="line"><span class="preprocessor">## <span class="number">5</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span>      <span class="number">554</span>        -<span class="number">6</span>      <span class="number">812</span>       -<span class="number">25</span>      DL  N668DN</span></span><br><span class="line"><span class="preprocessor">## Variables not shown: flight (int), origin (chr), dest (chr), air_time</span></span><br><span class="line"><span class="preprocessor">##   (dbl), distance (dbl), hour (dbl), minute (dbl)</span></span><br></pre></td></tr></table></figure>
<h2 id="Arrange_rows_with_arrange_28_29"><a href="#Arrange_rows_with_arrange_28_29" class="headerlink" title="Arrange rows with arrange()"></a>Arrange rows with arrange()</h2><ul>
<li>arrange() 函数用来对行排序</li>
<li>第一个参数是数据框</li>
<li>后面的参数是列名, 从前到后按照次序排序</li>
<li>默认升序, 如果要降序则使用desc()</li>
</ul>
<h3 id="u6309_u7167_u5E74_u6708_u65E5_u4F9D_u6B21_u6392_u5E8F"><a href="#u6309_u7167_u5E74_u6708_u65E5_u4F9D_u6B21_u6392_u5E8F" class="headerlink" title="按照年月日依次排序"></a>按照年月日依次排序</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arrange(flights, month, desc(day), dep_delay)</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">## Source: local data frame [<span class="number">336</span>,<span class="number">776</span> x <span class="number">16</span>]</span></span><br><span class="line"><span class="preprocessor">## </span></span><br><span class="line"><span class="preprocessor">##     year month   day dep_time dep_delay arr_time arr_delay carrier tailnum</span></span><br><span class="line"><span class="preprocessor">##    (int) (int) (int)    (int)     (dbl)    (int)     (dbl)   (chr)   (chr)</span></span><br><span class="line"><span class="preprocessor">## <span class="number">1</span>   <span class="number">2013</span>     <span class="number">1</span>    <span class="number">31</span>      <span class="number">821</span>       -<span class="number">13</span>     <span class="number">1041</span>         <span class="number">2</span>      EV  N13978</span></span><br><span class="line"><span class="preprocessor">## <span class="number">2</span>   <span class="number">2013</span>     <span class="number">1</span>    <span class="number">31</span>     <span class="number">1233</span>       -<span class="number">12</span>     <span class="number">1320</span>       -<span class="number">30</span>      AA  N3JRAA</span></span><br><span class="line"><span class="preprocessor">## <span class="number">3</span>   <span class="number">2013</span>     <span class="number">1</span>    <span class="number">31</span>     <span class="number">1918</span>       -<span class="number">12</span>     <span class="number">2157</span>         <span class="number">6</span>      <span class="number">9</span>E  N8924B</span></span><br><span class="line"><span class="preprocessor">## <span class="number">4</span>   <span class="number">2013</span>     <span class="number">1</span>    <span class="number">31</span>      <span class="number">549</span>       -<span class="number">11</span>      <span class="number">641</span>       -<span class="number">28</span>      B6  N239JB</span></span><br><span class="line"><span class="preprocessor">## <span class="number">5</span>   <span class="number">2013</span>     <span class="number">1</span>    <span class="number">31</span>      <span class="number">955</span>       -<span class="number">11</span>     <span class="number">1107</span>       -<span class="number">14</span>      EV  N836AS</span></span><br><span class="line"><span class="preprocessor">## <span class="number">6</span>   <span class="number">2013</span>     <span class="number">1</span>    <span class="number">31</span>      <span class="number">600</span>       -<span class="number">10</span>      <span class="number">911</span>         <span class="number">1</span>      AA  N5DMAA</span></span><br><span class="line"><span class="preprocessor">## <span class="number">7</span>   <span class="number">2013</span>     <span class="number">1</span>    <span class="number">31</span>     <span class="number">1119</span>       -<span class="number">10</span>     <span class="number">1421</span>         <span class="number">2</span>      B6  N712JB</span></span><br><span class="line"><span class="preprocessor">## <span class="number">8</span>   <span class="number">2013</span>     <span class="number">1</span>    <span class="number">31</span>     <span class="number">1135</span>       -<span class="number">10</span>     <span class="number">1257</span>       -<span class="number">24</span>      FL  N989AT</span></span><br><span class="line"><span class="preprocessor">## <span class="number">9</span>   <span class="number">2013</span>     <span class="number">1</span>    <span class="number">31</span>     <span class="number">1540</span>       -<span class="number">10</span>     <span class="number">1812</span>       -<span class="number">14</span>      <span class="number">9</span>E  N908XJ</span></span><br><span class="line"><span class="preprocessor">## <span class="number">10</span>  <span class="number">2013</span>     <span class="number">1</span>    <span class="number">31</span>      <span class="number">651</span>        -<span class="number">9</span>      <span class="number">839</span>       -<span class="number">11</span>      AA  N4XBAA</span></span><br><span class="line"><span class="preprocessor">## ..   ...   ...   ...      ...       ...      ...       ...     ...     ...</span></span><br><span class="line"><span class="preprocessor">## Variables not shown: flight (int), origin (chr), dest (chr), air_time</span></span><br><span class="line"><span class="preprocessor">##   (dbl), distance (dbl), hour (dbl), minute (dbl)</span></span><br></pre></td></tr></table></figure>
<h3 id="arrange_u7684_u7B49_u4EF7_u547D_u4EE4"><a href="#arrange_u7684_u7B49_u4EF7_u547D_u4EE4" class="headerlink" title="arrange的等价命令"></a>arrange的等价命令</h3><ul>
<li>dplyr::arrange() 与 plyr::arrange() 相似. </li>
<li>与order函数类似, 不过运用更简便.</li>
<li>以下情况等价</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">arrange(flights, year, month, day)</span><br><span class="line">flights[order(flights$year, flights$month, flights$day), ]</span><br><span class="line">arrange(flights, desc(arr_delay))</span><br><span class="line">flights[order(desc(flights$arr_delay)), ]</span><br></pre></td></tr></table></figure>
<h2 id="Select_columns_with_select_28_29"><a href="#Select_columns_with_select_28_29" class="headerlink" title="Select columns with select()"></a>Select columns with select()</h2><ul>
<li>目的: 大数据集的列太多, 并非全都用到</li>
<li>select函数用来选择列, 缩小数据量</li>
<li>对行不能筛选</li>
</ul>
<h3 id="u9009_u62E9_u5E74_u6708_u65E5_u4E09_u5217"><a href="#u9009_u62E9_u5E74_u6708_u65E5_u4E09_u5217" class="headerlink" title="选择年月日三列"></a>选择年月日三列</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select(flights, year, month, day)</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">## Source: local data frame [<span class="number">336</span>,<span class="number">776</span> x <span class="number">3</span>]</span></span><br><span class="line"><span class="preprocessor">## </span></span><br><span class="line"><span class="preprocessor">##     year month   day</span></span><br><span class="line"><span class="preprocessor">##    (int) (int) (int)</span></span><br><span class="line"><span class="preprocessor">## <span class="number">1</span>   <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">2</span>   <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">3</span>   <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">4</span>   <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">5</span>   <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">6</span>   <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">7</span>   <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">8</span>   <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">9</span>   <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">10</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span></span></span><br><span class="line"><span class="preprocessor">## ..   ...   ...   ...</span></span><br></pre></td></tr></table></figure>
<h3 id="u9009_u62E9_u76F8_u90BB_u5217"><a href="#u9009_u62E9_u76F8_u90BB_u5217" class="headerlink" title="选择相邻列"></a>选择相邻列</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select(flights, day:dep_delay)</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">## Source: local data frame [<span class="number">336</span>,<span class="number">776</span> x <span class="number">3</span>]</span></span><br><span class="line"><span class="preprocessor">## </span></span><br><span class="line"><span class="preprocessor">##      day dep_time dep_delay</span></span><br><span class="line"><span class="preprocessor">##    (int)    (int)     (dbl)</span></span><br><span class="line"><span class="preprocessor">## <span class="number">1</span>      <span class="number">1</span>      <span class="number">517</span>         <span class="number">2</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">2</span>      <span class="number">1</span>      <span class="number">533</span>         <span class="number">4</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">3</span>      <span class="number">1</span>      <span class="number">542</span>         <span class="number">2</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">4</span>      <span class="number">1</span>      <span class="number">544</span>        -<span class="number">1</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">5</span>      <span class="number">1</span>      <span class="number">554</span>        -<span class="number">6</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">6</span>      <span class="number">1</span>      <span class="number">554</span>        -<span class="number">4</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">7</span>      <span class="number">1</span>      <span class="number">555</span>        -<span class="number">5</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">8</span>      <span class="number">1</span>      <span class="number">557</span>        -<span class="number">3</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">9</span>      <span class="number">1</span>      <span class="number">557</span>        -<span class="number">3</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">10</span>     <span class="number">1</span>      <span class="number">558</span>        -<span class="number">2</span></span></span><br><span class="line"><span class="preprocessor">## ..   ...      ...       ...</span></span><br></pre></td></tr></table></figure>
<h3 id="u5220_u9664_u67D0_u4E9B_u5217"><a href="#u5220_u9664_u67D0_u4E9B_u5217" class="headerlink" title="删除某些列"></a>删除某些列</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select(flights, -(year:day))</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">## Source: local data frame [<span class="number">336</span>,<span class="number">776</span> x <span class="number">13</span>]</span></span><br><span class="line"><span class="preprocessor">## </span></span><br><span class="line"><span class="preprocessor">##    dep_time dep_delay arr_time arr_delay carrier tailnum flight origin</span></span><br><span class="line"><span class="preprocessor">##       (int)     (dbl)    (int)     (dbl)   (chr)   (chr)  (int)  (chr)</span></span><br><span class="line"><span class="preprocessor">## <span class="number">1</span>       <span class="number">517</span>         <span class="number">2</span>      <span class="number">830</span>        <span class="number">11</span>      UA  N14228   <span class="number">1545</span>    EWR</span></span><br><span class="line"><span class="preprocessor">## <span class="number">2</span>       <span class="number">533</span>         <span class="number">4</span>      <span class="number">850</span>        <span class="number">20</span>      UA  N24211   <span class="number">1714</span>    LGA</span></span><br><span class="line"><span class="preprocessor">## <span class="number">3</span>       <span class="number">542</span>         <span class="number">2</span>      <span class="number">923</span>        <span class="number">33</span>      AA  N619AA   <span class="number">1141</span>    JFK</span></span><br><span class="line"><span class="preprocessor">## <span class="number">4</span>       <span class="number">544</span>        -<span class="number">1</span>     <span class="number">1004</span>       -<span class="number">18</span>      B6  N804JB    <span class="number">725</span>    JFK</span></span><br><span class="line"><span class="preprocessor">## <span class="number">5</span>       <span class="number">554</span>        -<span class="number">6</span>      <span class="number">812</span>       -<span class="number">25</span>      DL  N668DN    <span class="number">461</span>    LGA</span></span><br><span class="line"><span class="preprocessor">## <span class="number">6</span>       <span class="number">554</span>        -<span class="number">4</span>      <span class="number">740</span>        <span class="number">12</span>      UA  N39463   <span class="number">1696</span>    EWR</span></span><br><span class="line"><span class="preprocessor">## <span class="number">7</span>       <span class="number">555</span>        -<span class="number">5</span>      <span class="number">913</span>        <span class="number">19</span>      B6  N516JB    <span class="number">507</span>    EWR</span></span><br><span class="line"><span class="preprocessor">## <span class="number">8</span>       <span class="number">557</span>        -<span class="number">3</span>      <span class="number">709</span>       -<span class="number">14</span>      EV  N829AS   <span class="number">5708</span>    LGA</span></span><br><span class="line"><span class="preprocessor">## <span class="number">9</span>       <span class="number">557</span>        -<span class="number">3</span>      <span class="number">838</span>        -<span class="number">8</span>      B6  N593JB     <span class="number">79</span>    JFK</span></span><br><span class="line"><span class="preprocessor">## <span class="number">10</span>      <span class="number">558</span>        -<span class="number">2</span>      <span class="number">753</span>         <span class="number">8</span>      AA  N3ALAA    <span class="number">301</span>    LGA</span></span><br><span class="line"><span class="preprocessor">## ..      ...       ...      ...       ...     ...     ...    ...    ...</span></span><br><span class="line"><span class="preprocessor">## Variables not shown: dest (chr), air_time (dbl), distance (dbl), hour</span></span><br><span class="line"><span class="preprocessor">##   (dbl), minute (dbl)</span></span><br></pre></td></tr></table></figure>
<h3 id="select_u7684_u5468_u8FB9_u51FD_u6570"><a href="#select_u7684_u5468_u8FB9_u51FD_u6570" class="headerlink" title="select的周边函数"></a>select的周边函数</h3><ul>
<li>select函数的功能也包含在base::subset()中, 用subset可以实现, 但不直接</li>
<li>select函数中, 选择列的时候可以使用很多其他函数来辅助, 比如<ul>
<li>starts_with()</li>
<li>ends_with()</li>
<li>matches() </li>
<li>contains() </li>
</ul>
</li>
<li>See ?select for more details.</li>
</ul>
<h3 id="u7EC3_u4E60-1"><a href="#u7EC3_u4E60-1" class="headerlink" title="练习"></a>练习</h3><ol>
<li>选择所有列名以”time”为结尾的列</li>
<li>选择所有列名中包含”rr”的列</li>
<li>选择所有列名长度不超过5个字符的列</li>
</ol>
<h3 id="u4F7F_u7528select_u66F4_u6539_u5217_u540D"><a href="#u4F7F_u7528select_u66F4_u6539_u5217_u540D" class="headerlink" title="使用select更改列名"></a>使用select更改列名</h3><p>You can rename variables with select() by using named arguments:</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select(flights, tail_num = tailnum)</span><br></pre></td></tr></table></figure>
<figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">## Source: local data frame [336,776 x 1]</span></span><br><span class="line"><span class="preprocessor">## </span></span><br><span class="line"><span class="preprocessor">##    tail_num</span></span><br><span class="line"><span class="preprocessor">##       (chr)</span></span><br><span class="line"><span class="preprocessor">## 1    N14228</span></span><br><span class="line"><span class="preprocessor">## 2    N24211</span></span><br><span class="line"><span class="preprocessor">## 3    N619AA</span></span><br><span class="line"><span class="preprocessor">## 4    N804JB</span></span><br><span class="line"><span class="preprocessor">## 5    N668DN</span></span><br><span class="line"><span class="preprocessor">## 6    N39463</span></span><br><span class="line"><span class="preprocessor">## 7    N516JB</span></span><br><span class="line"><span class="preprocessor">## 8    N829AS</span></span><br><span class="line"><span class="preprocessor">## 9    N593JB</span></span><br><span class="line"><span class="preprocessor">## 10   N3ALAA</span></span><br><span class="line"><span class="preprocessor">## ..      ...</span></span><br></pre></td></tr></table></figure>
<h3 id="u4F7F_u7528rename_u66F4_u6539_u5217_u540D"><a href="#u4F7F_u7528rename_u66F4_u6539_u5217_u540D" class="headerlink" title="使用rename更改列名"></a>使用rename更改列名</h3><p>使用select更改列名会只保存那些没更改的列, 因此一般不使用这个方法</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rename(flights, tail_num = tailnum)</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">## Source: local data frame [<span class="number">336</span>,<span class="number">776</span> x <span class="number">16</span>]</span></span><br><span class="line"><span class="preprocessor">## </span></span><br><span class="line"><span class="preprocessor">##     year month   day dep_time dep_delay arr_time arr_delay carrier</span></span><br><span class="line"><span class="preprocessor">##    (int) (int) (int)    (int)     (dbl)    (int)     (dbl)   (chr)</span></span><br><span class="line"><span class="preprocessor">## <span class="number">1</span>   <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span>      <span class="number">517</span>         <span class="number">2</span>      <span class="number">830</span>        <span class="number">11</span>      UA</span></span><br><span class="line"><span class="preprocessor">## <span class="number">2</span>   <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span>      <span class="number">533</span>         <span class="number">4</span>      <span class="number">850</span>        <span class="number">20</span>      UA</span></span><br><span class="line"><span class="preprocessor">## <span class="number">3</span>   <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span>      <span class="number">542</span>         <span class="number">2</span>      <span class="number">923</span>        <span class="number">33</span>      AA</span></span><br><span class="line"><span class="preprocessor">## <span class="number">4</span>   <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span>      <span class="number">544</span>        -<span class="number">1</span>     <span class="number">1004</span>       -<span class="number">18</span>      B6</span></span><br><span class="line"><span class="preprocessor">## <span class="number">5</span>   <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span>      <span class="number">554</span>        -<span class="number">6</span>      <span class="number">812</span>       -<span class="number">25</span>      DL</span></span><br><span class="line"><span class="preprocessor">## <span class="number">6</span>   <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span>      <span class="number">554</span>        -<span class="number">4</span>      <span class="number">740</span>        <span class="number">12</span>      UA</span></span><br><span class="line"><span class="preprocessor">## <span class="number">7</span>   <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span>      <span class="number">555</span>        -<span class="number">5</span>      <span class="number">913</span>        <span class="number">19</span>      B6</span></span><br><span class="line"><span class="preprocessor">## <span class="number">8</span>   <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span>      <span class="number">557</span>        -<span class="number">3</span>      <span class="number">709</span>       -<span class="number">14</span>      EV</span></span><br><span class="line"><span class="preprocessor">## <span class="number">9</span>   <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span>      <span class="number">557</span>        -<span class="number">3</span>      <span class="number">838</span>        -<span class="number">8</span>      B6</span></span><br><span class="line"><span class="preprocessor">## <span class="number">10</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span>      <span class="number">558</span>        -<span class="number">2</span>      <span class="number">753</span>         <span class="number">8</span>      AA</span></span><br><span class="line"><span class="preprocessor">## ..   ...   ...   ...      ...       ...      ...       ...     ...</span></span><br><span class="line"><span class="preprocessor">## Variables not shown: tail_num (chr), flight (int), origin (chr), dest</span></span><br><span class="line"><span class="preprocessor">##   (chr), air_time (dbl), distance (dbl), hour (dbl), minute (dbl)</span></span><br></pre></td></tr></table></figure>
<h2 id="Extract_distinct__28unique_29_rows"><a href="#Extract_distinct__28unique_29_rows" class="headerlink" title="Extract distinct (unique) rows"></a>Extract distinct (unique) rows</h2><p>联合使用select和distinct函数, 来选择某一列(某几列)的唯一值(类似unique)</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">distinct(select(flights, tailnum))</span><br></pre></td></tr></table></figure>
<figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">## Source: local data frame [4,044 x 1]</span></span><br><span class="line"><span class="preprocessor">## </span></span><br><span class="line"><span class="preprocessor">##    tailnum</span></span><br><span class="line"><span class="preprocessor">##      (chr)</span></span><br><span class="line"><span class="preprocessor">## 1   N14228</span></span><br><span class="line"><span class="preprocessor">## 2   N24211</span></span><br><span class="line"><span class="preprocessor">## 3   N619AA</span></span><br><span class="line"><span class="preprocessor">## 4   N804JB</span></span><br><span class="line"><span class="preprocessor">## 5   N668DN</span></span><br><span class="line"><span class="preprocessor">## 6   N39463</span></span><br><span class="line"><span class="preprocessor">## 7   N516JB</span></span><br><span class="line"><span class="preprocessor">## 8   N829AS</span></span><br><span class="line"><span class="preprocessor">## 9   N593JB</span></span><br><span class="line"><span class="preprocessor">## 10  N3ALAA</span></span><br><span class="line"><span class="preprocessor">## ..     ...</span></span><br></pre></td></tr></table></figure>
<h3 id="distinct_u591A_u5217"><a href="#distinct_u591A_u5217" class="headerlink" title="distinct多列"></a>distinct多列</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">distinct(select(flights, month, day))</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">## Source: local data frame [<span class="number">365</span> x <span class="number">2</span>]</span></span><br><span class="line"><span class="preprocessor">## </span></span><br><span class="line"><span class="preprocessor">##    month   day</span></span><br><span class="line"><span class="preprocessor">##    (int) (int)</span></span><br><span class="line"><span class="preprocessor">## <span class="number">1</span>      <span class="number">1</span>     <span class="number">1</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">2</span>      <span class="number">1</span>     <span class="number">2</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">3</span>      <span class="number">1</span>     <span class="number">3</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">4</span>      <span class="number">1</span>     <span class="number">4</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">5</span>      <span class="number">1</span>     <span class="number">5</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">6</span>      <span class="number">1</span>     <span class="number">6</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">7</span>      <span class="number">1</span>     <span class="number">7</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">8</span>      <span class="number">1</span>     <span class="number">8</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">9</span>      <span class="number">1</span>     <span class="number">9</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">10</span>     <span class="number">1</span>    <span class="number">10</span></span></span><br><span class="line"><span class="preprocessor">## ..   ...   ...</span></span><br></pre></td></tr></table></figure>
<h2 id="Add_new_columns_with_mutate_28_29"><a href="#Add_new_columns_with_mutate_28_29" class="headerlink" title="Add new columns with mutate()"></a>Add new columns with mutate()</h2><p>在数据框中生成新的列, 使用mutate()</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mutate(flights,</span><br><span class="line">  gain = arr_delay - dep_delay,</span><br><span class="line">  speed = distance / air_time * <span class="number">60</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">## Source: local data frame [<span class="number">336</span>,<span class="number">776</span> x <span class="number">18</span>]</span></span><br><span class="line"><span class="preprocessor">## </span></span><br><span class="line"><span class="preprocessor">##     year month   day dep_time dep_delay arr_time arr_delay carrier tailnum</span></span><br><span class="line"><span class="preprocessor">##    (int) (int) (int)    (int)     (dbl)    (int)     (dbl)   (chr)   (chr)</span></span><br><span class="line"><span class="preprocessor">## <span class="number">1</span>   <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span>      <span class="number">517</span>         <span class="number">2</span>      <span class="number">830</span>        <span class="number">11</span>      UA  N14228</span></span><br><span class="line"><span class="preprocessor">## <span class="number">2</span>   <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span>      <span class="number">533</span>         <span class="number">4</span>      <span class="number">850</span>        <span class="number">20</span>      UA  N24211</span></span><br><span class="line"><span class="preprocessor">## <span class="number">3</span>   <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span>      <span class="number">542</span>         <span class="number">2</span>      <span class="number">923</span>        <span class="number">33</span>      AA  N619AA</span></span><br><span class="line"><span class="preprocessor">## <span class="number">4</span>   <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span>      <span class="number">544</span>        -<span class="number">1</span>     <span class="number">1004</span>       -<span class="number">18</span>      B6  N804JB</span></span><br><span class="line"><span class="preprocessor">## <span class="number">5</span>   <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span>      <span class="number">554</span>        -<span class="number">6</span>      <span class="number">812</span>       -<span class="number">25</span>      DL  N668DN</span></span><br><span class="line"><span class="preprocessor">## <span class="number">6</span>   <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span>      <span class="number">554</span>        -<span class="number">4</span>      <span class="number">740</span>        <span class="number">12</span>      UA  N39463</span></span><br><span class="line"><span class="preprocessor">## <span class="number">7</span>   <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span>      <span class="number">555</span>        -<span class="number">5</span>      <span class="number">913</span>        <span class="number">19</span>      B6  N516JB</span></span><br><span class="line"><span class="preprocessor">## <span class="number">8</span>   <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span>      <span class="number">557</span>        -<span class="number">3</span>      <span class="number">709</span>       -<span class="number">14</span>      EV  N829AS</span></span><br><span class="line"><span class="preprocessor">## <span class="number">9</span>   <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span>      <span class="number">557</span>        -<span class="number">3</span>      <span class="number">838</span>        -<span class="number">8</span>      B6  N593JB</span></span><br><span class="line"><span class="preprocessor">## <span class="number">10</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span>      <span class="number">558</span>        -<span class="number">2</span>      <span class="number">753</span>         <span class="number">8</span>      AA  N3ALAA</span></span><br><span class="line"><span class="preprocessor">## ..   ...   ...   ...      ...       ...      ...       ...     ...     ...</span></span><br><span class="line"><span class="preprocessor">## Variables not shown: flight (int), origin (chr), dest (chr), air_time</span></span><br><span class="line"><span class="preprocessor">##   (dbl), distance (dbl), hour (dbl), minute (dbl), gain (dbl), speed (dbl)</span></span><br></pre></td></tr></table></figure>
<h3 id="mutate_u548Ctransform"><a href="#mutate_u548Ctransform" class="headerlink" title="mutate和transform"></a>mutate和transform</h3><ul>
<li>dplyr::mutate() 与 plyr::mutate() 和 base::transform() 类似. </li>
<li>mutate() 和 transform() 的主要区别是mutate能引用刚刚创建的列</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mutate(flights,</span><br><span class="line">  gain = arr_delay - dep_delay,</span><br><span class="line">  gain_per_hour = gain / (air_time / <span class="number">60</span>)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">## Source: local data frame [<span class="number">336</span>,<span class="number">776</span> x <span class="number">18</span>]</span></span><br><span class="line"><span class="preprocessor">## </span></span><br><span class="line"><span class="preprocessor">##     year month   day dep_time dep_delay arr_time arr_delay carrier tailnum</span></span><br><span class="line"><span class="preprocessor">##    (int) (int) (int)    (int)     (dbl)    (int)     (dbl)   (chr)   (chr)</span></span><br><span class="line"><span class="preprocessor">## <span class="number">1</span>   <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span>      <span class="number">517</span>         <span class="number">2</span>      <span class="number">830</span>        <span class="number">11</span>      UA  N14228</span></span><br><span class="line"><span class="preprocessor">## <span class="number">2</span>   <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span>      <span class="number">533</span>         <span class="number">4</span>      <span class="number">850</span>        <span class="number">20</span>      UA  N24211</span></span><br><span class="line"><span class="preprocessor">## <span class="number">3</span>   <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span>      <span class="number">542</span>         <span class="number">2</span>      <span class="number">923</span>        <span class="number">33</span>      AA  N619AA</span></span><br><span class="line"><span class="preprocessor">## <span class="number">4</span>   <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span>      <span class="number">544</span>        -<span class="number">1</span>     <span class="number">1004</span>       -<span class="number">18</span>      B6  N804JB</span></span><br><span class="line"><span class="preprocessor">## <span class="number">5</span>   <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span>      <span class="number">554</span>        -<span class="number">6</span>      <span class="number">812</span>       -<span class="number">25</span>      DL  N668DN</span></span><br><span class="line"><span class="preprocessor">## <span class="number">6</span>   <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span>      <span class="number">554</span>        -<span class="number">4</span>      <span class="number">740</span>        <span class="number">12</span>      UA  N39463</span></span><br><span class="line"><span class="preprocessor">## <span class="number">7</span>   <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span>      <span class="number">555</span>        -<span class="number">5</span>      <span class="number">913</span>        <span class="number">19</span>      B6  N516JB</span></span><br><span class="line"><span class="preprocessor">## <span class="number">8</span>   <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span>      <span class="number">557</span>        -<span class="number">3</span>      <span class="number">709</span>       -<span class="number">14</span>      EV  N829AS</span></span><br><span class="line"><span class="preprocessor">## <span class="number">9</span>   <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span>      <span class="number">557</span>        -<span class="number">3</span>      <span class="number">838</span>        -<span class="number">8</span>      B6  N593JB</span></span><br><span class="line"><span class="preprocessor">## <span class="number">10</span>  <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span>      <span class="number">558</span>        -<span class="number">2</span>      <span class="number">753</span>         <span class="number">8</span>      AA  N3ALAA</span></span><br><span class="line"><span class="preprocessor">## ..   ...   ...   ...      ...       ...      ...       ...     ...     ...</span></span><br><span class="line"><span class="preprocessor">## Variables not shown: flight (int), origin (chr), dest (chr), air_time</span></span><br><span class="line"><span class="preprocessor">##   (dbl), distance (dbl), hour (dbl), minute (dbl), gain (dbl),</span></span><br><span class="line"><span class="preprocessor">##   gain_per_hour (dbl)</span></span><br></pre></td></tr></table></figure>
<h3 id="u5982_u679C_u4F7F_u7528transform"><a href="#u5982_u679C_u4F7F_u7528transform" class="headerlink" title="如果使用transform"></a>如果使用transform</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">transform(flights,</span><br><span class="line">  gain = arr_delay - dep_delay,</span><br><span class="line">  gain_per_hour = gain / (air_time / <span class="number">60</span>)</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<p>会出现error</p>
<h2 id="Summarise_values_with_summarise_28_29"><a href="#Summarise_values_with_summarise_28_29" class="headerlink" title="Summarise values with summarise()"></a>Summarise values with summarise()</h2><ul>
<li>与plyr::summarise())功能相同</li>
<li>将一个数据框退化为一行</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">summarise(flights,</span><br><span class="line">  delay = mean(dep_delay, na.rm = <span class="literal">TRUE</span>))</span><br></pre></td></tr></table></figure>
<figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">## Source: local data frame [1 x 1]</span></span><br><span class="line"><span class="preprocessor">## </span></span><br><span class="line"><span class="preprocessor">##      delay</span></span><br><span class="line"><span class="preprocessor">##      (dbl)</span></span><br><span class="line"><span class="preprocessor">## 1 12.63907</span></span><br></pre></td></tr></table></figure>
<h2 id="u968F_u673A_u9009_u62E9_u884C"><a href="#u968F_u673A_u9009_u62E9_u884C" class="headerlink" title="随机选择行"></a>随机选择行</h2><p>随机抽样</p>
<ul>
<li>sample_n() 抽固定个数</li>
<li>sample_frac() 抽固定比例</li>
<li>可以使用replace = TRUE参数</li>
<li>base::sample 不能应用于数据框</li>
</ul>
<h3 id="sample_n_28_29"><a href="#sample_n_28_29" class="headerlink" title="sample_n()"></a>sample_n()</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sample_n(flights, <span class="number">5</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">## Source: local data frame [<span class="number">5</span> x <span class="number">16</span>]</span></span><br><span class="line"><span class="preprocessor">## </span></span><br><span class="line"><span class="preprocessor">##    year month   day dep_time dep_delay arr_time arr_delay carrier tailnum</span></span><br><span class="line"><span class="preprocessor">##   (int) (int) (int)    (int)     (dbl)    (int)     (dbl)   (chr)   (chr)</span></span><br><span class="line"><span class="preprocessor">## <span class="number">1</span>  <span class="number">2013</span>     <span class="number">3</span>    <span class="number">25</span>       NA        NA       NA        NA      EV  N11565</span></span><br><span class="line"><span class="preprocessor">## <span class="number">2</span>  <span class="number">2013</span>     <span class="number">7</span>    <span class="number">16</span>      <span class="number">833</span>        <span class="number">48</span>      <span class="number">946</span>        <span class="number">31</span>      UA  N14704</span></span><br><span class="line"><span class="preprocessor">## <span class="number">3</span>  <span class="number">2013</span>    <span class="number">12</span>     <span class="number">5</span>     <span class="number">1923</span>       <span class="number">138</span>     <span class="number">2120</span>       <span class="number">131</span>      US  N197UW</span></span><br><span class="line"><span class="preprocessor">## <span class="number">4</span>  <span class="number">2013</span>    <span class="number">10</span>    <span class="number">22</span>     <span class="number">2001</span>         <span class="number">0</span>     <span class="number">2246</span>        -<span class="number">2</span>      B6  N523JB</span></span><br><span class="line"><span class="preprocessor">## <span class="number">5</span>  <span class="number">2013</span>    <span class="number">10</span>    <span class="number">19</span>      <span class="number">650</span>       -<span class="number">10</span>      <span class="number">804</span>       -<span class="number">29</span>      UA  N848UA</span></span><br><span class="line"><span class="preprocessor">## Variables not shown: flight (int), origin (chr), dest (chr), air_time</span></span><br><span class="line"><span class="preprocessor">##   (dbl), distance (dbl), hour (dbl), minute (dbl)</span></span><br></pre></td></tr></table></figure>
<h3 id="sample_frac_28_29"><a href="#sample_frac_28_29" class="headerlink" title="sample_frac()"></a>sample_frac()</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sample_frac(flights, <span class="number">0.01</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">## Source: local data frame [<span class="number">3</span>,<span class="number">368</span> x <span class="number">16</span>]</span></span><br><span class="line"><span class="preprocessor">## </span></span><br><span class="line"><span class="preprocessor">##     year month   day dep_time dep_delay arr_time arr_delay carrier tailnum</span></span><br><span class="line"><span class="preprocessor">##    (int) (int) (int)    (int)     (dbl)    (int)     (dbl)   (chr)   (chr)</span></span><br><span class="line"><span class="preprocessor">## <span class="number">1</span>   <span class="number">2013</span>    <span class="number">11</span>    <span class="number">15</span>      <span class="number">821</span>        -<span class="number">9</span>      <span class="number">936</span>        -<span class="number">8</span>      <span class="number">9</span>E  N602LR</span></span><br><span class="line"><span class="preprocessor">## <span class="number">2</span>   <span class="number">2013</span>     <span class="number">9</span>    <span class="number">17</span>     <span class="number">1621</span>        -<span class="number">6</span>     <span class="number">1743</span>       -<span class="number">11</span>      EV  N14905</span></span><br><span class="line"><span class="preprocessor">## <span class="number">3</span>   <span class="number">2013</span>     <span class="number">8</span>    <span class="number">21</span>     <span class="number">2144</span>        -<span class="number">6</span>     <span class="number">2245</span>       -<span class="number">26</span>      EV  N22971</span></span><br><span class="line"><span class="preprocessor">## <span class="number">4</span>   <span class="number">2013</span>     <span class="number">3</span>    <span class="number">23</span>      <span class="number">923</span>         <span class="number">3</span>     <span class="number">1251</span>         <span class="number">6</span>      AA  N4XVAA</span></span><br><span class="line"><span class="preprocessor">## <span class="number">5</span>   <span class="number">2013</span>     <span class="number">2</span>    <span class="number">25</span>      <span class="number">852</span>        -<span class="number">8</span>     <span class="number">1215</span>        -<span class="number">1</span>      UA  N415UA</span></span><br><span class="line"><span class="preprocessor">## <span class="number">6</span>   <span class="number">2013</span>     <span class="number">8</span>    <span class="number">11</span>      <span class="number">758</span>        -<span class="number">2</span>      <span class="number">951</span>       -<span class="number">28</span>      <span class="number">9</span>E  N600LR</span></span><br><span class="line"><span class="preprocessor">## <span class="number">7</span>   <span class="number">2013</span>    <span class="number">10</span>     <span class="number">1</span>     <span class="number">1021</span>        -<span class="number">9</span>     <span class="number">1318</span>       -<span class="number">22</span>      VX  N636VA</span></span><br><span class="line"><span class="preprocessor">## <span class="number">8</span>   <span class="number">2013</span>     <span class="number">8</span>    <span class="number">20</span>     <span class="number">2358</span>        -<span class="number">1</span>      <span class="number">322</span>       -<span class="number">18</span>      B6  N662JB</span></span><br><span class="line"><span class="preprocessor">## <span class="number">9</span>   <span class="number">2013</span>    <span class="number">10</span>    <span class="number">21</span>     <span class="number">1350</span>       -<span class="number">10</span>     <span class="number">1445</span>       -<span class="number">22</span>      US  N954UW</span></span><br><span class="line"><span class="preprocessor">## <span class="number">10</span>  <span class="number">2013</span>     <span class="number">4</span>    <span class="number">24</span>     <span class="number">1606</span>        -<span class="number">4</span>     <span class="number">1754</span>        -<span class="number">6</span>      AA  N4XDAA</span></span><br><span class="line"><span class="preprocessor">## ..   ...   ...   ...      ...       ...      ...       ...     ...     ...</span></span><br><span class="line"><span class="preprocessor">## Variables not shown: flight (int), origin (chr), dest (chr), air_time</span></span><br><span class="line"><span class="preprocessor">##   (dbl), distance (dbl), hour (dbl), minute (dbl)</span></span><br></pre></td></tr></table></figure>
<h2 id="dplyr_u8FDB_u9636"><a href="#dplyr_u8FDB_u9636" class="headerlink" title="dplyr进阶"></a>dplyr进阶</h2><h3 id="u4EE5_u4E0A_u547D_u4EE4_u7684_u5171_u540C_u70B9"><a href="#u4EE5_u4E0A_u547D_u4EE4_u7684_u5171_u540C_u70B9" class="headerlink" title="以上命令的共同点"></a>以上命令的共同点</h3><p>以上介绍的dplyr中的语法和函数有以下共同点:</p>
<ul>
<li>第一个参数永远是数据框的名字</li>
<li>接下来的参数是告诉R你想做什么事情, 无需$符号来引用, 语言直白</li>
<li>结论是一个新的数据框</li>
</ul>
<h3 id="u8054_u5408_u4F7F_u7528"><a href="#u8054_u5408_u4F7F_u7528" class="headerlink" title="联合使用"></a>联合使用</h3><p>以上操作联合使用, 可以进行比较复杂的数据框操作:</p>
<ul>
<li>对行排序: arrange</li>
<li>选择一些行和列: filter, select</li>
<li>给数据框新添一些变量: mutate</li>
<li>对某些变量进行总结: summarise</li>
</ul>
<p>对数据框进行按行分组以后, 再对某些变量总结会更好</p>
<h3 id="Grouped_operations"><a href="#Grouped_operations" class="headerlink" title="Grouped operations"></a>Grouped operations</h3><p>对数据框进行按行分组的方法: group_by(). 经过分组以后:</p>
<ul>
<li>select 与无分组时一样</li>
<li>arrange 优先按照分组变量来排序, 然后才对参数中的变量排序</li>
<li>mutate 和 filter 与一些 window function 一起操作(min), 最强大</li>
<li>vignette(“window-functions”) 查看 window function</li>
<li>sample_n() 和 sample_frac() 分组后在每组内分别抽样</li>
<li>slice 也在组内抽取行</li>
<li>summarise 最好用</li>
</ul>
<p>去除分组: ungroup()</p>
<h2 id="u4F7F_u7528_u5206_u7EC4_u8FDB_u884C_u53D8_u91CF_u7EDF_u8BA1"><a href="#u4F7F_u7528_u5206_u7EC4_u8FDB_u884C_u53D8_u91CF_u7EDF_u8BA1" class="headerlink" title="使用分组进行变量统计"></a>使用分组进行变量统计</h2><p>考虑以下问题的计算:</p>
<ul>
<li>每架飞机在2013年的飞行次数(飞机尾号变量tailnum)</li>
<li>每架飞机在2013年的平均飞行距离(distance)</li>
<li>每架飞机在2013年的平均延迟到达时间(arr_delay)</li>
</ul>
<h3 id="u4F7F_u7528_group_by__u8FDB_u884C_u7EDF_u8BA1"><a href="#u4F7F_u7528_group_by__u8FDB_u884C_u7EDF_u8BA1" class="headerlink" title="使用 group_by 进行统计"></a>使用 group_by 进行统计</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">by_tailnum &lt;- group_by(flights, tailnum)</span><br><span class="line">delay &lt;- summarise(by_tailnum,</span><br><span class="line">  count = n(),</span><br><span class="line">  dist = mean(distance, na.rm = <span class="literal">TRUE</span>),</span><br><span class="line">  delay = mean(arr_delay, na.rm = <span class="literal">TRUE</span>))</span><br><span class="line">delay &lt;- filter(delay, count &gt; <span class="number">20</span>, dist &lt; <span class="number">2000</span>)</span><br></pre></td></tr></table></figure>
<h3 id="u4F7F_u7528_ggplot2__u53EF_u89C6_u5316"><a href="#u4F7F_u7528_ggplot2__u53EF_u89C6_u5316" class="headerlink" title="使用 ggplot2 可视化"></a>使用 ggplot2 可视化</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">library</span>(ggplot2)</span><br><span class="line">ggplot(delay, aes(dist, delay)) +</span><br><span class="line">  geom_point(aes(size = count), alpha = <span class="number">1</span>/<span class="number">2</span>) +</span><br><span class="line">  geom_smooth() +</span><br><span class="line">  scale_size_area()</span><br></pre></td></tr></table></figure>
<figure class="highlight ocaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">## geom_smooth: <span class="keyword">method</span>=<span class="string">"auto"</span> <span class="keyword">and</span> size <span class="keyword">of</span> largest group is &gt;=<span class="number">1000</span>, so using gam <span class="keyword">with</span> formula: y ~ s(x, bs = <span class="string">"cs"</span>). <span class="type">Use</span> <span class="symbol">'method</span> = x' <span class="keyword">to</span> change the smoothing <span class="keyword">method</span>.</span><br></pre></td></tr></table></figure>
<p><img src="http://7xo4sl.com1.z0.glb.clouddn.com/2015/R_language/dplyr.png" alt=""> </p>
<h2 id="summarise_u548C_u5176_u4ED6_u51FD_u6570_u7ED3_u5408_u4F7F_u7528"><a href="#summarise_u548C_u5176_u4ED6_u51FD_u6570_u7ED3_u5408_u4F7F_u7528" class="headerlink" title="summarise和其他函数结合使用"></a>summarise和其他函数结合使用</h2><p>与summarise结合的函数的特点: 参数为向量, 结果返回单个数:</p>
<ul>
<li>min(), max(), mean(), sum(), sd(), median(), and IQR()</li>
</ul>
<p>dplyr包提供的类似函数有:</p>
<ul>
<li>n(): 本组中的观测数量(计数)</li>
<li>n_distinct(x): x中的 unique values 的数量</li>
<li>first(x), last(x) and nth(x, n) 类似 x[1], x[length(x)] 和 x[n]</li>
</ul>
<h3 id="u8BA1_u7B97_u6BCF_u4E2A_u76EE_u7684_u5730_u63A5_u5F85_u7684_u98DE_u673A_u6570_u91CF_u548C_u964D_u843D_u6B21_u6570"><a href="#u8BA1_u7B97_u6BCF_u4E2A_u76EE_u7684_u5730_u63A5_u5F85_u7684_u98DE_u673A_u6570_u91CF_u548C_u964D_u843D_u6B21_u6570" class="headerlink" title="计算每个目的地接待的飞机数量和降落次数"></a>计算每个目的地接待的飞机数量和降落次数</h3><ul>
<li>目的地: dest</li>
<li>飞机数量: tailnum</li>
<li>降落次数: 使用n()</li>
</ul>
<h3 id="u8BA1_u7B97_u6BCF_u4E2A_u76EE_u7684_u5730_u63A5_u5F85_u7684_u98DE_u673A_u6570_u91CF_u548C_u964D_u843D_u6B21_u6570-1"><a href="#u8BA1_u7B97_u6BCF_u4E2A_u76EE_u7684_u5730_u63A5_u5F85_u7684_u98DE_u673A_u6570_u91CF_u548C_u964D_u843D_u6B21_u6570-1" class="headerlink" title="计算每个目的地接待的飞机数量和降落次数"></a>计算每个目的地接待的飞机数量和降落次数</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">destinations &lt;- group_by(flights, dest)</span><br><span class="line">summarise(destinations,</span><br><span class="line">  planes = n_distinct(tailnum),</span><br><span class="line">  flights = n()</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">## Source: local data frame [<span class="number">105</span> x <span class="number">3</span>]</span></span><br><span class="line"><span class="preprocessor">## </span></span><br><span class="line"><span class="preprocessor">##     dest planes flights</span></span><br><span class="line"><span class="preprocessor">##    (chr)  (int)   (int)</span></span><br><span class="line"><span class="preprocessor">## <span class="number">1</span>    ABQ    <span class="number">108</span>     <span class="number">254</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">2</span>    ACK     <span class="number">58</span>     <span class="number">265</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">3</span>    ALB    <span class="number">172</span>     <span class="number">439</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">4</span>    ANC      <span class="number">6</span>       <span class="number">8</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">5</span>    ATL   <span class="number">1180</span>   <span class="number">17215</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">6</span>    AUS    <span class="number">993</span>    <span class="number">2439</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">7</span>    AVL    <span class="number">159</span>     <span class="number">275</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">8</span>    BDL    <span class="number">186</span>     <span class="number">443</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">9</span>    BGR     <span class="number">46</span>     <span class="number">375</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">10</span>   BHM     <span class="number">45</span>     <span class="number">297</span></span></span><br><span class="line"><span class="preprocessor">## ..   ...    ...     ...</span></span><br></pre></td></tr></table></figure>
<h3 id="u4F7F_u7528_group_by__u8FDB_u884C_u591A_u5C42_u7EA7_u5206_u7EC4"><a href="#u4F7F_u7528_group_by__u8FDB_u884C_u591A_u5C42_u7EA7_u5206_u7EC4" class="headerlink" title="使用 group_by 进行多层级分组"></a>使用 group_by 进行多层级分组</h3><p>按天统计航班数量</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">daily &lt;- group_by(flights, year, month, day)</span><br><span class="line">(per_day   &lt;- summarise(daily, flights = n()))</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">## Source: local data frame [<span class="number">365</span> x <span class="number">4</span>]</span></span><br><span class="line"><span class="preprocessor">## Groups: year, month [?]</span></span><br><span class="line"><span class="preprocessor">## </span></span><br><span class="line"><span class="preprocessor">##     year month   day flights</span></span><br><span class="line"><span class="preprocessor">##    (int) (int) (int)   (int)</span></span><br><span class="line"><span class="preprocessor">## <span class="number">1</span>   <span class="number">2013</span>     <span class="number">1</span>     <span class="number">1</span>     <span class="number">842</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">2</span>   <span class="number">2013</span>     <span class="number">1</span>     <span class="number">2</span>     <span class="number">943</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">3</span>   <span class="number">2013</span>     <span class="number">1</span>     <span class="number">3</span>     <span class="number">914</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">4</span>   <span class="number">2013</span>     <span class="number">1</span>     <span class="number">4</span>     <span class="number">915</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">5</span>   <span class="number">2013</span>     <span class="number">1</span>     <span class="number">5</span>     <span class="number">720</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">6</span>   <span class="number">2013</span>     <span class="number">1</span>     <span class="number">6</span>     <span class="number">832</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">7</span>   <span class="number">2013</span>     <span class="number">1</span>     <span class="number">7</span>     <span class="number">933</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">8</span>   <span class="number">2013</span>     <span class="number">1</span>     <span class="number">8</span>     <span class="number">899</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">9</span>   <span class="number">2013</span>     <span class="number">1</span>     <span class="number">9</span>     <span class="number">902</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">10</span>  <span class="number">2013</span>     <span class="number">1</span>    <span class="number">10</span>     <span class="number">932</span></span></span><br><span class="line"><span class="preprocessor">## ..   ...   ...   ...     ...</span></span><br></pre></td></tr></table></figure>
<h3 id="u6309_u6708_u7EDF_u8BA1_u822A_u73ED_u6570_u91CF"><a href="#u6309_u6708_u7EDF_u8BA1_u822A_u73ED_u6570_u91CF" class="headerlink" title="按月统计航班数量"></a>按月统计航班数量</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(per_month &lt;- summarise(per_day, flights = sum(flights)))</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">## Source: local data frame [<span class="number">12</span> x <span class="number">3</span>]</span></span><br><span class="line"><span class="preprocessor">## Groups: year [?]</span></span><br><span class="line"><span class="preprocessor">## </span></span><br><span class="line"><span class="preprocessor">##     year month flights</span></span><br><span class="line"><span class="preprocessor">##    (int) (int)   (int)</span></span><br><span class="line"><span class="preprocessor">## <span class="number">1</span>   <span class="number">2013</span>     <span class="number">1</span>   <span class="number">27004</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">2</span>   <span class="number">2013</span>     <span class="number">2</span>   <span class="number">24951</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">3</span>   <span class="number">2013</span>     <span class="number">3</span>   <span class="number">28834</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">4</span>   <span class="number">2013</span>     <span class="number">4</span>   <span class="number">28330</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">5</span>   <span class="number">2013</span>     <span class="number">5</span>   <span class="number">28796</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">6</span>   <span class="number">2013</span>     <span class="number">6</span>   <span class="number">28243</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">7</span>   <span class="number">2013</span>     <span class="number">7</span>   <span class="number">29425</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">8</span>   <span class="number">2013</span>     <span class="number">8</span>   <span class="number">29327</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">9</span>   <span class="number">2013</span>     <span class="number">9</span>   <span class="number">27574</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">10</span>  <span class="number">2013</span>    <span class="number">10</span>   <span class="number">28889</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">11</span>  <span class="number">2013</span>    <span class="number">11</span>   <span class="number">27268</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">12</span>  <span class="number">2013</span>    <span class="number">12</span>   <span class="number">28135</span></span></span><br></pre></td></tr></table></figure>
<h3 id="u6309_u5E74_u7EDF_u8BA1_u822A_u73ED_u6570_u91CF"><a href="#u6309_u5E74_u7EDF_u8BA1_u822A_u73ED_u6570_u91CF" class="headerlink" title="按年统计航班数量"></a>按年统计航班数量</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(per_year  &lt;- summarise(per_month, flights = sum(flights)))</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">## Source: local data frame [<span class="number">1</span> x <span class="number">2</span>]</span></span><br><span class="line"><span class="preprocessor">## </span></span><br><span class="line"><span class="preprocessor">##    year flights</span></span><br><span class="line"><span class="preprocessor">##   (int)   (int)</span></span><br><span class="line"><span class="preprocessor">## <span class="number">1</span>  <span class="number">2013</span>  <span class="number">336776</span></span></span><br></pre></td></tr></table></figure>
<h2 id="u7BA1_u9053_u64CD_u4F5C"><a href="#u7BA1_u9053_u64CD_u4F5C" class="headerlink" title="管道操作"></a>管道操作</h2><h3 id="dplyr__u57FA_u672C_u8BED_u6CD5_u7684_u5F0A_u75C5"><a href="#dplyr__u57FA_u672C_u8BED_u6CD5_u7684_u5F0A_u75C5" class="headerlink" title="dplyr 基本语法的弊病"></a>dplyr 基本语法的弊病</h3><p>如果要对数据做很多操作, 则代码只能一步产生一个新数据框.</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">a1 &lt;- group_by(flights, year, month, day)</span><br><span class="line">a2 &lt;- select(a1, arr_delay, dep_delay)</span><br><span class="line">a3 &lt;- summarise(a2,</span><br><span class="line">  arr = mean(arr_delay, na.rm = <span class="literal">TRUE</span>),</span><br><span class="line">  dep = mean(dep_delay, na.rm = <span class="literal">TRUE</span>))</span><br><span class="line">a4 &lt;- filter(a3, arr &gt; <span class="number">30</span> | dep &gt; <span class="number">30</span>)</span><br></pre></td></tr></table></figure>
<h3 id="u5D4C_u5957_u5F0F_u5199_u6CD5"><a href="#u5D4C_u5957_u5F0F_u5199_u6CD5" class="headerlink" title="嵌套式写法"></a>嵌套式写法</h3><p>如果不想出现中间结果, 则需要使用嵌套写法</p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">filter(</span><br><span class="line">  summarise(</span><br><span class="line">    select(</span><br><span class="line">      group_by(flights, year, month, day),</span><br><span class="line">      arr_delay, dep_delay</span><br><span class="line">    ),</span><br><span class="line">    arr = mean(arr_delay, na.rm = <span class="literal">TRUE</span>),</span><br><span class="line">    dep = mean(dep_delay, na.rm = <span class="literal">TRUE</span>)</span><br><span class="line">  ),</span><br><span class="line">  arr &gt; <span class="number">30</span> | dep &gt; <span class="number">30</span></span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">## Source: local data frame [<span class="number">49</span> x <span class="number">5</span>]</span></span><br><span class="line"><span class="preprocessor">## Groups: year, month [<span class="number">11</span>]</span></span><br><span class="line"><span class="preprocessor">## </span></span><br><span class="line"><span class="preprocessor">##     year month   day      arr      dep</span></span><br><span class="line"><span class="preprocessor">##    (int) (int) (int)    (dbl)    (dbl)</span></span><br><span class="line"><span class="preprocessor">## <span class="number">1</span>   <span class="number">2013</span>     <span class="number">1</span>    <span class="number">16</span> <span class="number">34.24736</span> <span class="number">24.61287</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">2</span>   <span class="number">2013</span>     <span class="number">1</span>    <span class="number">31</span> <span class="number">32.60285</span> <span class="number">28.65836</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">3</span>   <span class="number">2013</span>     <span class="number">2</span>    <span class="number">11</span> <span class="number">36.29009</span> <span class="number">39.07360</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">4</span>   <span class="number">2013</span>     <span class="number">2</span>    <span class="number">27</span> <span class="number">31.25249</span> <span class="number">37.76327</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">5</span>   <span class="number">2013</span>     <span class="number">3</span>     <span class="number">8</span> <span class="number">85.86216</span> <span class="number">83.53692</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">6</span>   <span class="number">2013</span>     <span class="number">3</span>    <span class="number">18</span> <span class="number">41.29189</span> <span class="number">30.11796</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">7</span>   <span class="number">2013</span>     <span class="number">4</span>    <span class="number">10</span> <span class="number">38.41231</span> <span class="number">33.02368</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">8</span>   <span class="number">2013</span>     <span class="number">4</span>    <span class="number">12</span> <span class="number">36.04814</span> <span class="number">34.83843</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">9</span>   <span class="number">2013</span>     <span class="number">4</span>    <span class="number">18</span> <span class="number">36.02848</span> <span class="number">34.91536</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">10</span>  <span class="number">2013</span>     <span class="number">4</span>    <span class="number">19</span> <span class="number">47.91170</span> <span class="number">46.12783</span></span></span><br><span class="line"><span class="preprocessor">## ..   ...   ...   ...      ...      ...</span></span><br></pre></td></tr></table></figure>
<h3 id="u7BA1_u9053_u64CD_u4F5C_3A_Pipe_operator"><a href="#u7BA1_u9053_u64CD_u4F5C_3A_Pipe_operator" class="headerlink" title="管道操作: Pipe operator"></a>管道操作: Pipe operator</h3><ul>
<li>嵌套操作难以读懂(从内往外读)</li>
<li>dplyr提供了 %&gt;% 操作符, x %&gt;% f(y) 即 f(x, y)</li>
</ul>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">flights %&gt;%</span><br><span class="line">  group_by(year, month, day) %&gt;%</span><br><span class="line">  select(arr_delay, dep_delay) %&gt;%</span><br><span class="line">  summarise(</span><br><span class="line">    arr = mean(arr_delay, na.rm = <span class="literal">TRUE</span>),</span><br><span class="line">    dep = mean(dep_delay, na.rm = <span class="literal">TRUE</span>)</span><br><span class="line">  ) %&gt;%</span><br><span class="line">  filter(arr &gt; <span class="number">30</span> | dep &gt; <span class="number">30</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">## Source: local data frame [<span class="number">49</span> x <span class="number">5</span>]</span></span><br><span class="line"><span class="preprocessor">## Groups: year, month [<span class="number">11</span>]</span></span><br><span class="line"><span class="preprocessor">## </span></span><br><span class="line"><span class="preprocessor">##     year month   day      arr      dep</span></span><br><span class="line"><span class="preprocessor">##    (int) (int) (int)    (dbl)    (dbl)</span></span><br><span class="line"><span class="preprocessor">## <span class="number">1</span>   <span class="number">2013</span>     <span class="number">1</span>    <span class="number">16</span> <span class="number">34.24736</span> <span class="number">24.61287</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">2</span>   <span class="number">2013</span>     <span class="number">1</span>    <span class="number">31</span> <span class="number">32.60285</span> <span class="number">28.65836</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">3</span>   <span class="number">2013</span>     <span class="number">2</span>    <span class="number">11</span> <span class="number">36.29009</span> <span class="number">39.07360</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">4</span>   <span class="number">2013</span>     <span class="number">2</span>    <span class="number">27</span> <span class="number">31.25249</span> <span class="number">37.76327</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">5</span>   <span class="number">2013</span>     <span class="number">3</span>     <span class="number">8</span> <span class="number">85.86216</span> <span class="number">83.53692</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">6</span>   <span class="number">2013</span>     <span class="number">3</span>    <span class="number">18</span> <span class="number">41.29189</span> <span class="number">30.11796</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">7</span>   <span class="number">2013</span>     <span class="number">4</span>    <span class="number">10</span> <span class="number">38.41231</span> <span class="number">33.02368</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">8</span>   <span class="number">2013</span>     <span class="number">4</span>    <span class="number">12</span> <span class="number">36.04814</span> <span class="number">34.83843</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">9</span>   <span class="number">2013</span>     <span class="number">4</span>    <span class="number">18</span> <span class="number">36.02848</span> <span class="number">34.91536</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">10</span>  <span class="number">2013</span>     <span class="number">4</span>    <span class="number">19</span> <span class="number">47.91170</span> <span class="number">46.12783</span></span></span><br><span class="line"><span class="preprocessor">## ..   ...   ...   ...      ...      ...</span></span><br></pre></td></tr></table></figure>
<h3 id="u7EC3_u4E60-2"><a href="#u7EC3_u4E60-2" class="headerlink" title="练习"></a>练习</h3><ol>
<li>求平均飞行时间最长的三条航线</li>
<li>2013年上半年, 飞行距离1000以上及以下的航班平均延误时间各为多少? </li>
</ol>
<h2 id="u7EC3_u4E60_u9898_u7B54_u6848"><a href="#u7EC3_u4E60_u9898_u7B54_u6848" class="headerlink" title="练习题答案"></a>练习题答案</h2><h3 id="2013_u5E743_u6708_u4E2D_u65EC_2C__u5EF6_u8FDF_u8D77_u98DE_u7684_u73ED_u6B21_u6709_u591A_u5C11_3F"><a href="#2013_u5E743_u6708_u4E2D_u65EC_2C__u5EF6_u8FDF_u8D77_u98DE_u7684_u73ED_u6B21_u6709_u591A_u5C11_3F" class="headerlink" title="2013年3月中旬, 延迟起飞的班次有多少?"></a>2013年3月中旬, 延迟起飞的班次有多少?</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nrow(filter(flights, month == <span class="number">3</span>, </span><br><span class="line">            day &gt; <span class="number">10</span>, day &lt; <span class="number">21</span>, dep_delay &gt; <span class="number">0</span>))</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">## [<span class="number">1</span>] <span class="number">4073</span></span></span><br></pre></td></tr></table></figure>
<h3 id="u5168_u5E74_u54EA_u4E2A_u6708_u4EFD_u7684_u73ED_u6B21_u5EF6_u8FDF_u5230_u8FBE_u7684_u6BD4_u4F8B_u6700_u9AD8_3F"><a href="#u5168_u5E74_u54EA_u4E2A_u6708_u4EFD_u7684_u73ED_u6B21_u5EF6_u8FDF_u5230_u8FBE_u7684_u6BD4_u4F8B_u6700_u9AD8_3F" class="headerlink" title="全年哪个月份的班次延迟到达的比例最高?"></a>全年哪个月份的班次延迟到达的比例最高?</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">month_flights &lt;- table(flights$month)</span><br><span class="line">month_delay &lt;- table((filter(flights, </span><br><span class="line">                             arr_delay &gt; <span class="number">0</span>))$month)</span><br><span class="line">which.max(month_delay / month_flights)</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">## <span class="number">12</span> </span></span><br><span class="line"><span class="preprocessor">## <span class="number">12</span></span></span><br></pre></td></tr></table></figure>
<h3 id="u5217_u540D_u9009_u62E9_u95EE_u9898_u7B54_u6848"><a href="#u5217_u540D_u9009_u62E9_u95EE_u9898_u7B54_u6848" class="headerlink" title="列名选择问题答案"></a>列名选择问题答案</h3><ol>
<li>选择所有列名以”time”为结尾的列</li>
<li>选择所有列名中包含”rr”的列</li>
<li>选择所有列名长度不超过5个字符的列</li>
</ol>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select(flights, ends_with(<span class="string">"time"</span>))</span><br><span class="line">select(flights, contains(<span class="string">"rr"</span>))</span><br><span class="line">flights[,nchar(colnames(flights)) &lt; <span class="number">6</span>]</span><br></pre></td></tr></table></figure>
<h3 id="u6C42_u5E73_u5747_u98DE_u884C_u65F6_u95F4_u6700_u957F_u7684_u4E09_u6761_u822A_u7EBF"><a href="#u6C42_u5E73_u5747_u98DE_u884C_u65F6_u95F4_u6700_u957F_u7684_u4E09_u6761_u822A_u7EBF" class="headerlink" title="求平均飞行时间最长的三条航线"></a>求平均飞行时间最长的三条航线</h3><figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">flights %&gt;%</span><br><span class="line">  group_by(origin, dest) %&gt;%</span><br><span class="line">  select(air_time, origin, dest) %&gt;%</span><br><span class="line">  summarise(air_mean = mean(air_time, na.rm = <span class="literal">T</span>)) %&gt;%</span><br><span class="line">  ungroup() %&gt;%</span><br><span class="line">  arrange(desc(air_mean)) %&gt;%</span><br><span class="line">  slice(<span class="number">1</span>:<span class="number">3</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">## Source: local data frame [<span class="number">3</span> x <span class="number">3</span>]</span></span><br><span class="line"><span class="preprocessor">## </span></span><br><span class="line"><span class="preprocessor">##   origin  dest air_mean</span></span><br><span class="line"><span class="preprocessor">##    (chr) (chr)    (dbl)</span></span><br><span class="line"><span class="preprocessor">## <span class="number">1</span>    JFK   HNL <span class="number">623.0877</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">2</span>    EWR   HNL <span class="number">612.0752</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">3</span>    EWR   ANC <span class="number">413.1250</span></span></span><br></pre></td></tr></table></figure>
<h3 id="u98DE_u884C_u8DDD_u79BB1000_u4EE5_u4E0A_u53CA_u4EE5_u4E0B_u7684_u822A_u73ED_u5E73_u5747_u5EF6_u8FDF_u5230_u8FBE_u65F6_u95F4"><a href="#u98DE_u884C_u8DDD_u79BB1000_u4EE5_u4E0A_u53CA_u4EE5_u4E0B_u7684_u822A_u73ED_u5E73_u5747_u5EF6_u8FDF_u5230_u8FBE_u65F6_u95F4" class="headerlink" title="飞行距离1000以上及以下的航班平均延迟到达时间"></a>飞行距离1000以上及以下的航班平均延迟到达时间</h3><p>2013年上半年, 飞行距离1000以上及以下的航班平均延迟到达时间各为多少? </p>
<figure class="highlight r"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">flights %&gt;%</span><br><span class="line">  filter(month &lt; <span class="number">7</span>) %&gt;%</span><br><span class="line">  mutate(above1000 = distance &gt; <span class="number">1000</span>) %&gt;%</span><br><span class="line">  select(above1000, arr_delay) %&gt;%</span><br><span class="line">  group_by(above1000) %&gt;%</span><br><span class="line">  summarise(mean(arr_delay, na.rm = <span class="literal">T</span>))</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">## Source: local data frame [<span class="number">2</span> x <span class="number">2</span>]</span></span><br><span class="line"><span class="preprocessor">## </span></span><br><span class="line"><span class="preprocessor">##   above1000 mean(arr_delay, na.rm = T)</span></span><br><span class="line"><span class="preprocessor">##       (lgl)                      (dbl)</span></span><br><span class="line"><span class="preprocessor">## <span class="number">1</span>     FALSE                  <span class="number">10.944168</span></span></span><br><span class="line"><span class="preprocessor">## <span class="number">2</span>      TRUE                   <span class="number">4.618789</span></span></span><br></pre></td></tr></table></figure>
  
	</div>
		<footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/R/">R</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/R-package/">R package</a><a href="/tags/R-programing/">R programing</a>
  </div>

</div>



	<div class="article-share" id="share">
	
	  <div data-url="http://ripeconan.com/2015/11/23/dplyr/" data-title="数据处理之dplyr包 | ripeconan" data-tsina="null" class="share clearfix">
	  </div>
	
	</div>


</footer>

   	       
	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/2015/12/07/6_probability_statistics/" title="概率统计">
  <strong>上一篇：</strong><br/>
  <span>
  概率统计</span>
</a>
</div>


<div class="next">
<a href="/2015/11/15/control_flow_function/"  title="控制流和函数">
 <strong>下一篇：</strong><br/> 
 <span>控制流和函数
</span>
</a>
</div>

</nav>

	

</div>  
      <div class="openaside"><a class="navbutton" href="#" title="顯示側邊欄"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">文章目錄</strong>
 
 <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#dplyr_u7B80_u4ECB"><span class="toc-number">1.</span> <span class="toc-text">dplyr简介</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#u5B89_u88C5_u5305"><span class="toc-number">1.1.</span> <span class="toc-text">安装包</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#dplyr_u4E3B_u8981_u529F_u80FD"><span class="toc-number">1.2.</span> <span class="toc-text">dplyr主要功能</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#u6570_u636E_u96C6_u4E86_u89E3"><span class="toc-number">1.3.</span> <span class="toc-text">数据集了解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#u67E5_u770B_u6570_u636E_u96C6"><span class="toc-number">1.4.</span> <span class="toc-text">查看数据集</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Filter_rows_with_filter_28_29"><span class="toc-number">2.</span> <span class="toc-text">Filter rows with filter()</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Use_filter_to_select_all_flights_on_March_13st"><span class="toc-number">2.1.</span> <span class="toc-text">Use filter to select all flights on March 13st</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#filter__u548C_u666E_u901A_u7B5B_u9009_u7684_u533A_u522B"><span class="toc-number">2.2.</span> <span class="toc-text">filter 和普通筛选的区别</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#u4F7F_u7528_u7EC4_u5408_u6761_u4EF6_u7B5B_u9009_u884C"><span class="toc-number">2.3.</span> <span class="toc-text">使用组合条件筛选行</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#u7EC3_u4E60"><span class="toc-number">2.4.</span> <span class="toc-text">练习</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#u4F7F_u7528_u884C_u53F7_u7B5B_u9009_u884C"><span class="toc-number">2.5.</span> <span class="toc-text">使用行号筛选行</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Arrange_rows_with_arrange_28_29"><span class="toc-number">3.</span> <span class="toc-text">Arrange rows with arrange()</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#u6309_u7167_u5E74_u6708_u65E5_u4F9D_u6B21_u6392_u5E8F"><span class="toc-number">3.1.</span> <span class="toc-text">按照年月日依次排序</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#arrange_u7684_u7B49_u4EF7_u547D_u4EE4"><span class="toc-number">3.2.</span> <span class="toc-text">arrange的等价命令</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Select_columns_with_select_28_29"><span class="toc-number">4.</span> <span class="toc-text">Select columns with select()</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#u9009_u62E9_u5E74_u6708_u65E5_u4E09_u5217"><span class="toc-number">4.1.</span> <span class="toc-text">选择年月日三列</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#u9009_u62E9_u76F8_u90BB_u5217"><span class="toc-number">4.2.</span> <span class="toc-text">选择相邻列</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#u5220_u9664_u67D0_u4E9B_u5217"><span class="toc-number">4.3.</span> <span class="toc-text">删除某些列</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#select_u7684_u5468_u8FB9_u51FD_u6570"><span class="toc-number">4.4.</span> <span class="toc-text">select的周边函数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#u7EC3_u4E60-1"><span class="toc-number">4.5.</span> <span class="toc-text">练习</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#u4F7F_u7528select_u66F4_u6539_u5217_u540D"><span class="toc-number">4.6.</span> <span class="toc-text">使用select更改列名</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#u4F7F_u7528rename_u66F4_u6539_u5217_u540D"><span class="toc-number">4.7.</span> <span class="toc-text">使用rename更改列名</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Extract_distinct__28unique_29_rows"><span class="toc-number">5.</span> <span class="toc-text">Extract distinct (unique) rows</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#distinct_u591A_u5217"><span class="toc-number">5.1.</span> <span class="toc-text">distinct多列</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Add_new_columns_with_mutate_28_29"><span class="toc-number">6.</span> <span class="toc-text">Add new columns with mutate()</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#mutate_u548Ctransform"><span class="toc-number">6.1.</span> <span class="toc-text">mutate和transform</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#u5982_u679C_u4F7F_u7528transform"><span class="toc-number">6.2.</span> <span class="toc-text">如果使用transform</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Summarise_values_with_summarise_28_29"><span class="toc-number">7.</span> <span class="toc-text">Summarise values with summarise()</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#u968F_u673A_u9009_u62E9_u884C"><span class="toc-number">8.</span> <span class="toc-text">随机选择行</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#sample_n_28_29"><span class="toc-number">8.1.</span> <span class="toc-text">sample_n()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#sample_frac_28_29"><span class="toc-number">8.2.</span> <span class="toc-text">sample_frac()</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#dplyr_u8FDB_u9636"><span class="toc-number">9.</span> <span class="toc-text">dplyr进阶</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#u4EE5_u4E0A_u547D_u4EE4_u7684_u5171_u540C_u70B9"><span class="toc-number">9.1.</span> <span class="toc-text">以上命令的共同点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#u8054_u5408_u4F7F_u7528"><span class="toc-number">9.2.</span> <span class="toc-text">联合使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Grouped_operations"><span class="toc-number">9.3.</span> <span class="toc-text">Grouped operations</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#u4F7F_u7528_u5206_u7EC4_u8FDB_u884C_u53D8_u91CF_u7EDF_u8BA1"><span class="toc-number">10.</span> <span class="toc-text">使用分组进行变量统计</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#u4F7F_u7528_group_by__u8FDB_u884C_u7EDF_u8BA1"><span class="toc-number">10.1.</span> <span class="toc-text">使用 group_by 进行统计</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#u4F7F_u7528_ggplot2__u53EF_u89C6_u5316"><span class="toc-number">10.2.</span> <span class="toc-text">使用 ggplot2 可视化</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#summarise_u548C_u5176_u4ED6_u51FD_u6570_u7ED3_u5408_u4F7F_u7528"><span class="toc-number">11.</span> <span class="toc-text">summarise和其他函数结合使用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#u8BA1_u7B97_u6BCF_u4E2A_u76EE_u7684_u5730_u63A5_u5F85_u7684_u98DE_u673A_u6570_u91CF_u548C_u964D_u843D_u6B21_u6570"><span class="toc-number">11.1.</span> <span class="toc-text">计算每个目的地接待的飞机数量和降落次数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#u8BA1_u7B97_u6BCF_u4E2A_u76EE_u7684_u5730_u63A5_u5F85_u7684_u98DE_u673A_u6570_u91CF_u548C_u964D_u843D_u6B21_u6570-1"><span class="toc-number">11.2.</span> <span class="toc-text">计算每个目的地接待的飞机数量和降落次数</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#u4F7F_u7528_group_by__u8FDB_u884C_u591A_u5C42_u7EA7_u5206_u7EC4"><span class="toc-number">11.3.</span> <span class="toc-text">使用 group_by 进行多层级分组</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#u6309_u6708_u7EDF_u8BA1_u822A_u73ED_u6570_u91CF"><span class="toc-number">11.4.</span> <span class="toc-text">按月统计航班数量</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#u6309_u5E74_u7EDF_u8BA1_u822A_u73ED_u6570_u91CF"><span class="toc-number">11.5.</span> <span class="toc-text">按年统计航班数量</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#u7BA1_u9053_u64CD_u4F5C"><span class="toc-number">12.</span> <span class="toc-text">管道操作</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#dplyr__u57FA_u672C_u8BED_u6CD5_u7684_u5F0A_u75C5"><span class="toc-number">12.1.</span> <span class="toc-text">dplyr 基本语法的弊病</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#u5D4C_u5957_u5F0F_u5199_u6CD5"><span class="toc-number">12.2.</span> <span class="toc-text">嵌套式写法</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#u7BA1_u9053_u64CD_u4F5C_3A_Pipe_operator"><span class="toc-number">12.3.</span> <span class="toc-text">管道操作: Pipe operator</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#u7EC3_u4E60-2"><span class="toc-number">12.4.</span> <span class="toc-text">练习</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#u7EC3_u4E60_u9898_u7B54_u6848"><span class="toc-number">13.</span> <span class="toc-text">练习题答案</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#2013_u5E743_u6708_u4E2D_u65EC_2C__u5EF6_u8FDF_u8D77_u98DE_u7684_u73ED_u6B21_u6709_u591A_u5C11_3F"><span class="toc-number">13.1.</span> <span class="toc-text">2013年3月中旬, 延迟起飞的班次有多少?</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#u5168_u5E74_u54EA_u4E2A_u6708_u4EFD_u7684_u73ED_u6B21_u5EF6_u8FDF_u5230_u8FBE_u7684_u6BD4_u4F8B_u6700_u9AD8_3F"><span class="toc-number">13.2.</span> <span class="toc-text">全年哪个月份的班次延迟到达的比例最高?</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#u5217_u540D_u9009_u62E9_u95EE_u9898_u7B54_u6848"><span class="toc-number">13.3.</span> <span class="toc-text">列名选择问题答案</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#u6C42_u5E73_u5747_u98DE_u884C_u65F6_u95F4_u6700_u957F_u7684_u4E09_u6761_u822A_u7EBF"><span class="toc-number">13.4.</span> <span class="toc-text">求平均飞行时间最长的三条航线</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#u98DE_u884C_u8DDD_u79BB1000_u4EE5_u4E0A_u53CA_u4EE5_u4E0B_u7684_u822A_u73ED_u5E73_u5747_u5EF6_u8FDF_u5230_u8FBE_u65F6_u95F4"><span class="toc-number">13.5.</span> <span class="toc-text">飞行距离1000以上及以下的航班平均延迟到达时间</span></a></li></ol></li></ol>
 
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隱藏側邊欄"></a></div>
<aside class="clearfix">

  


  
<div class="categorieslist">
	<p class="asidetitle">分類</p>
		<ul>
		
		  
			<li><a href="/categories/Learning/" title="Learning">Learning<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Machine-Learning/" title="Machine Learning">Machine Learning<sup>3</sup></a></li>
		  
		
		  
			<li><a href="/categories/R/" title="R">R<sup>7</sup></a></li>
		  
		
		</ul>
</div>


  
<div class="tagslist">
	<p class="asidetitle">標簽</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/R-programing/" title="R programing">R programing<sup>6</sup></a></li>
			
		
			
				<li><a href="/tags/data-mining/" title="data mining">data mining<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/R-package/" title="R package">R package<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/R-函数/" title="R 函数">R 函数<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/To-Do/" title="To Do">To Do<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/algorithms/" title="algorithms">algorithms<sup>1</sup></a></li>
			
		
		</ul>
</div>


  <div class="linkslist">
  <p class="asidetitle">友情鏈接</p>
    <ul>
        
          <li>
            
            	<a href="http://zjdian.com/" target="_blank" title="中继点">中继点</a>
            
          </li>
        
          <li>
            
            	<a href="http://blog.fens.me/" target="_blank" title="粉丝日志">粉丝日志</a>
            
          </li>
        
    </ul>
</div>

  


  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS 訂閱</a>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	
	<section class="info">
		<p> Design your life, Build your dream. <br/>
			     </p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		
		
		
		
		
		
		
		
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2015 
		
		<a href="/about" target="_blank" title="ripeconan">ripeconan</a>
		
		
		</p>
</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  c.click(function(){
    ta.css('display', 'block').addClass('fadeIn');
  });
  o.click(function(){
    ta.css('display', 'none');
  });
  $(window).scroll(function(){
    ta.css("top",Math.max(140,320-$(this).scrollTop()));
  });
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina'),
      description = $this.attr('description');
  var html = [
  '<div class="hoverqrcode clearfix"></div>',
  '<a class="overlay" id="qrcode"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="微信"></a>',
  '<a href="http://widget.renren.com/dialog/share?resourceUrl=' + encodedUrl + '&srcUrl=' + encodedUrl + '&title=' + title +'" class="article-share-renren" target="_blank" title="人人"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="微博"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);

  $('.hoverqrcode').hide();

  var myWidth = 0;
  function updatehoverqrcode(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
    var qrsize = myWidth > 1024 ? 200:100;
    var options = {render: 'image', size: qrsize, fill: '#2ca6cb', text: url, radius: 0.5, quiet: 1};
    var p = $('.article-share-qrcode').position();
    $('.hoverqrcode').empty().css('width', qrsize).css('height', qrsize)
                          .css('left', p.left-qrsize/2+20).css('top', p.top-qrsize-10)
                          .qrcode(options);
  };
  $(window).resize(function(){
    $('.hoverqrcode').hide();
  });
  $('.article-share-qrcode').click(function(){
    updatehoverqrcode();
    $('.hoverqrcode').toggle();
  });
  $('.article-share-qrcode').hover(function(){}, function(){
      $('.hoverqrcode').hide();
  });
});   
</script>









<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>





<!-- Analytics Begin -->



<script type="text/javascript">
var _bdhmProtocol = (("https:" == document.location.protocol) ? " https://" : " http://");
document.write(unescape("%3Cscript src='" + _bdhmProtocol + "hm.baidu.com/h.js%3Fe6d1f421bbc9962127a50488f9ed37d1' type='text/javascript'%3E%3C/script%3E"));
</script>



<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="返回頂部"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->

  </body>
</html>
